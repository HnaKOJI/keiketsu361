<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="./style.css">
  <title>検索結果</title>
</head>
<body id="search-body">
  <h1>検索結果</h1>
  <div id="results">読み込み中...</div>

  <script>
    const params = new URLSearchParams(location.search);
    const keyword = params.get("keyword");
    const mode = params.get("mode") || "point";

    async function loadData() {
      const [qRes, aRes] = await Promise.all([
        fetch("questions.json"),
        fetch("choices.json")
      ]);
      const questionsData = await qRes.json();
      const answersData = await aRes.json();

      const categoryNames = {
        "1": "督脈", "2": "任脈", "3": "手の太陰肺経", "4": "手の陽明大腸経",
        "5": "足の陽明胃経", "6": "足の太陰脾経", "7": "手の少陰心経", "8": "手の太陽小腸経",
        "9": "足の太陽膀胱経", "10": "足の少陰腎経", "11": "手の厥陰心包経",
        "12": "手の少陽三焦経", "13": "足の少陽胆経", "14": "足の厥陰肝経", "15": "奇穴"
      };

      const results = document.getElementById("results");
      results.innerHTML = "";

      if (mode === "point") {
        let found = false;
        for (const cat in answersData) {
          if (answersData[cat][keyword]) {
            const answer = Array.isArray(answersData[cat][keyword])
              ? answersData[cat][keyword].join("<br>")
              : answersData[cat][keyword];
            results.innerHTML = `<div class="result-box">
              <strong>${keyword}</strong><br>${answer}
            </div>`;
            found = true;
            break;
          }
        }
        if (!found) {
          results.innerHTML = `<div class="result-box">「${keyword}」は見つかりませんでした。</div>`;
        }
      }

      if (mode === "meridian") {
        const catEntry = Object.entries(categoryNames).find(([_, name]) => name === keyword);
        if (!catEntry) {
          results.innerHTML = `<div class="result-box">「${keyword}」という経脈は見つかりませんでした。</div>`;
          return;
        }

        const [catNum] = catEntry;
        const list = questionsData[catNum] || [];
        const ansMap = answersData[catNum] || {};

        if (list.length === 0) {
          results.innerHTML = `<div class="result-box">「${keyword}」の経穴データが見つかりません。</div>`;
          return;
        }

        results.innerHTML = `<h2>${keyword} の経穴一覧</h2>`;
        for (const q of list) {
          const ans = ansMap[q.id];
          if (ans) {
            const body = Array.isArray(ans) ? ans.join("<br>") : ans;
            const box = document.createElement("div");
            box.className = "result-box";
            box.innerHTML = `<strong>${q.id}</strong><br>${body}`;
            results.appendChild(box);
          }
        }
      }
    }

    loadData();
  </script>
    <div style="margin-top: 40px; display: flex; justify-content: center;">
        <a href="index.html">
            <button>カテゴリ選択に戻る</button>
        </a>
    </div>
</body>
</html>
